---
website: https://info.dengue.mat.br/
compact-title: no
output:
  pdf_document:
    latex_engine: xelatex
    keep_tex: no
    fig_caption: yes
    includes:
      in_header: preamble.tex
theme: metropolis
documentclass: report
editor_options:
  chunk_output_type: console
fontsize: 12pt
---

```{r, comment = "", setup, include = FALSE}
knitr::opts_chunk$set(message = FALSE, echo = FALSE, 
                      dpi = 600, warning = F)

knitr::knit_hooks$set(crop = knitr::hook_pdfcrop)
knitr::opts_chunk$set(message=F, echo = F, warning = F, dpi = 300)
knitr::opts_chunk$set(fig.pos = "!H", out.extra = "")
options(knitr.duplicate.label = "allow")
options(scipen = 999999)

# Sys.setenv(LANG = "en")
Sys.setlocale("LC_TIME", "pt_BR.UTF-8")
```

```{r, include = FALSE}
r_pkgs <- c("tidyverse", "AlertTools", "sf", "arrow",
            "ggplot2", "ggpubr", "geofacet",
            "janitor", "kableExtra", "xtable",
            "sjstats", "sjPlot", "gt", "gtExtras", "INLA")

if(!"pacman" %in% rownames(installed.packages())) install.packages("pacman")
pacman::p_load(char = r_pkgs)
source("../scripts/funcoes_extras.R", encoding = "utf-8")
```

```{r, include = FALSE}
load(file = "../data/muns.R") 
muns <- muns %>% 
  mutate(regional_id = as.character(regional_id))

file_list <- list.files(path = "../data/casos_dengue/", pattern = ".parquet", full.names = TRUE)
df_dengue <- lapply(file_list, read_parquet)
df_dengue <- bind_rows(df_dengue) %>% 
  left_join(muns %>% 
              dplyr::select(-nome),, by = "municipio_geocodigo") %>% 
  mutate(
    incest = casos_est/pop * 100000,
    arbovirose = "Dengue"
  ) %>% 
  filter(substr(SE, 1, 4) < 2024)

file_list <- list.files(path = "../data/cases2024/", pattern = "dengue.parquet", full.names = TRUE)
df_dengue2 <- lapply(file_list, read_parquet)
df_dengue2 <- bind_rows(df_dengue2) %>% 
  left_join(muns %>% 
              dplyr::select(-nome),, by = "municipio_geocodigo") %>% 
  mutate(
    incest = casos_est/pop * 100000,
    arbovirose = "Dengue"
  ) %>% 
  filter(substr(SE, 1, 4) >= 2024)

file_list <- list.files(path = "../data/casos_chik/", pattern = ".parquet", full.names = TRUE)
df_chik <- lapply(file_list, read_parquet)
df_chik <- bind_rows(df_chik) %>% 
  left_join(muns %>% 
              dplyr::select(-nome), by = "municipio_geocodigo")%>% 
  mutate(
    incest = casos_est/pop * 100000,
    arbovirose = "Chikungunya"
  ) %>% 
  filter(substr(SE, 1, 4) < 2024)

file_list <- list.files(path = "../data/cases2024/", pattern = "chik.parquet", full.names = TRUE)
df_chik2 <- lapply(file_list, read_parquet)
df_chik2 <- bind_rows(df_chik2) %>% 
  left_join(muns %>% 
              dplyr::select(-nome),, by = "municipio_geocodigo") %>% 
  mutate(
    incest = casos_est/pop * 100000,
    arbovirose = "Chikungunya"
  ) %>% 
  filter(substr(SE, 1, 4) >= 2024)

df_dengue <- df_dengue %>% 
  bind_rows(df_dengue2)

df_chik <- df_chik %>% 
  bind_rows(df_chik2)

df_dengue_chik <- df_dengue %>% 
  bind_rows(df_chik)

shape <- st_read("../shape/rs_450_RepCor1.shp") %>% 
  rename(regional_id = primary.id) %>% 
  mutate(regional_id = as.character((regional_id))) %>% 
  dplyr::select(-c(id, secondary)) %>% 
  left_join(
    muns %>% 
      dplyr::select(regional_id, regional) %>% 
      distinct(regional_id, .keep_all = T),
    by = "regional_id"
  )
```


```{r, include = FALSE}
# Parametros
ano_selecionado <- year(Sys.Date())
se_max_dengue  <- max(df_dengue$SE) # Semana epidemiologia mais recente
se_max_chik  <- max(df_chik$SE) # Semana epidemiologia mais recente
ultima_semana_dengue <- substr(se_max_dengue, 5, 6)
ultima_semana_chik <- substr(se_max_chik, 5, 6)

ultima_semana_inicio <- SE2date(se_max_dengue)$ini
ultima_semana_fim <- ultima_semana_inicio + 6
ultima_semana_inicio <- paste0(substr(ultima_semana_inicio, 9, 10),"/", substr(ultima_semana_inicio, 6, 7), "/", substr(ultima_semana_inicio, 1, 4))

ultima_semana_fim <- paste0(substr(ultima_semana_fim, 9, 10),"/", substr(ultima_semana_fim, 6, 7), "/", substr(ultima_semana_fim, 1, 4))
```

```{r, include = FALSE}
# MEM
load("../data/mem2024.RData")

# Dengue
memUFanual <- memUFanual %>% 
  rename(codigo = nome) %>% 
  mutate(codigo = as.character(codigo)) %>% 
  obter_siglas_codigos(merge_by = "codigo")

memReganual <- memReganual %>%
  rename(
    regional_id = nome,
    codigo = uf) %>%
  mutate(
    regional_id = as.character(regional_id),
    codigo = as.character(codigo)
  ) %>%
  obter_siglas_codigos(merge_by = "codigo")

memUFsazonal <- memUFsazonal %>%
  rename(
    codigo = uf) %>%
  mutate(
    codigo = as.character(codigo)
  ) %>%
  obter_siglas_codigos(merge_by = "codigo")

## Chikv
memUFanual.chi <- memUFanual.chi %>% 
  rename(codigo = nome) %>% 
  mutate(codigo = as.character(codigo)) %>% 
  obter_siglas_codigos(merge_by = "codigo")

memReganual.chi <- memReganual.chi %>% 
  rename(
    regional_id = nome,
    codigo = uf) %>% 
  mutate(
    regional_id = as.character(regional_id),
    codigo = as.character(codigo)
  ) %>% 
  obter_siglas_codigos(merge_by = "codigo")

memUFsazonal.chi <- memUFsazonal.chi %>%
  rename(
    codigo = uf) %>%
  mutate(
    codigo = as.character(codigo)
  ) %>%
  obter_siglas_codigos(merge_by = "codigo")
```


```{r, include = FALSE}
df_dengue_nacional <- df_dengue %>% obter_metricas_nacionais() #Nacional
df_dengue_uf <- df_dengue %>% 
  obter_metricas_estaduais() %>% # Estadual
  mutate(
    ano = as.numeric(substr(SE, 1, 4)),
    semana = as.numeric(substr(SE, 5, 6))
  ) 
df_dengue_total <- df_dengue %>% obter_metricas_estaduais_por_ano() # Estadual (por ano)
df_dengue_macro_se <- df_dengue %>% obter_metricas_macrorregionais_por_semana() # Macroregional (por semana)

df_dengue_reg <- df_dengue %>% obter_metricas_regionais_por_semana() %>% 
  obter_siglas_codigos(merge_by = "codigo") # Regional
tabela_dengue <- obter_tabela(df = df_dengue, df_mem = memUFanual, se_max_dengue) # Tabela Estadual

df_dengue_regional_se <- df_dengue_reg %>% 
  filter(SE == se_max_dengue) %>%
  select(regional_id, codigo, pop, incest) %>% 
  mutate(regional_id = as.character(regional_id))

tabela_reg_dengue <- obter_metricas_por_regional(
  df_mem_regional_anual = memReganual,
  df_regional_se = df_dengue_regional_se
)

tabela_reg_dengue <- obter_classificacao_das_regionais(df_dengue_reg, tabela_reg_dengue)
tab_pop_risco_dengue <- tabela_reg_dengue %>% obter_pop_sob_risco()

shape_dengue <- shape %>%
  left_join(tabela_reg_dengue, by = "regional_id")

gg_pop_risco_dengue <- tab_pop_risco_dengue %>% 
  gg_bar_pop_risco(por_regiao = F)

gg_map_risco_classif_dengue <- obter_mapa_risco_classif(
  shape = shape_dengue %>% 
    mutate(
      status = case_when(
        is.na(status) ~ "Não se aplica",
        TRUE~status
      ),
      status = factor(status, levels = c("Alto em subida", "Alto estável", "Alto em queda", "Baixo ou moderado", "Não se aplica"))
    )
)
```


```{r, include = FALSE}
# Chikungunya
df_chik_nacional <- df_chik %>% obter_metricas_nacionais() #Nacional
df_chik_uf <- df_chik %>% 
  obter_metricas_estaduais() %>% # Estadual
  mutate(
    ano = as.numeric(substr(SE, 1, 4)),
    semana = as.numeric(substr(SE, 5, 6))
  )  # Estadual
df_chik_total <- df_chik %>% obter_metricas_estaduais_por_ano() # Estadual (por ano)
df_chik_macro_se <- df_chik %>% obter_metricas_macrorregionais_por_semana() # Macroregional (por semana)
df_chik_reg <- df_chik %>% obter_metricas_regionais_por_semana() %>% 
  obter_siglas_codigos(merge_by = "codigo") # Regional
tabela_chik <- obter_tabela(df = df_chik, df_mem = memUFanual, se_max_chik) # Tabela Estadual

df_chik_regional_se <- df_chik_reg %>% 
  filter(SE == se_max_chik) %>%
  select(regional_id, codigo, pop, incest) %>% 
  mutate(regional_id = as.character(regional_id))

tabela_reg_chik <- obter_metricas_por_regional(
  df_mem_regional_anual = memReganual.chi,
  df_regional_se = df_chik_regional_se
)

tabela_reg_chik <- obter_classificacao_das_regionais(df_chik_reg, tabela_reg_chik)
tab_pop_risco_chik <- tabela_reg_chik %>% obter_pop_sob_risco()

shape_chik <- shape %>%
  left_join(tabela_reg_chik, by = "regional_id")

gg_pop_risco_chik <- tab_pop_risco_chik %>% 
  gg_bar_pop_risco(por_regiao = T)

gg_map_risco_classif_chik <- obter_mapa_risco_classif(
  shape = shape_chik %>% 
    mutate(
      status = case_when(
        is.na(status) ~ "Não se aplica",
        TRUE~status
      ),
      status = factor(status, levels = c("Alto em subida", "Alto estável", "Alto em queda", "Baixo ou moderado", "Não se aplica"))
    )
)
```

```{r, include = FALSE}
# Informacoes textuais - dengue

# Ano selecionado
df_ano_selecionado_dengue <- df_dengue %>% 
  filter(as.numeric(substr(SE, 1, 4)) == ano_selecionado) 

pop_brasil_ano_selecionado_dengue <- sum(df_ano_selecionado_dengue %>% 
                                           arrange(desc(SE)) %>% 
                                           dplyr::select(municipio_geocodigo, pop) %>% 
                                           distinct(municipio_geocodigo, .keep_all = T) %>% 
                                           pull(pop), na.rm = T)

total_casos_ano_selecionado_dengue <- sum(df_ano_selecionado_dengue %>% 
                                            pull(casos), na.rm = T)

total_casos_provaveis_ano_selecionado_dengue <- sum(df_ano_selecionado_dengue %>% 
                                                      pull(casprov), na.rm = T)

prop_casos_provaveis_dengue <- paste0(round(total_casos_provaveis_ano_selecionado_dengue/total_casos_ano_selecionado_dengue *100, 2),"%")

incidencia_acumulada_ano_selecionado_dengue <- total_casos_ano_selecionado_dengue/ pop_brasil_ano_selecionado_dengue * 10^5

# Ano anterior
df_ano_anterior_dengue <- df_dengue %>% 
  filter(as.numeric(substr(SE, 1, 4)) == (ano_selecionado - 1))

pop_brasil_ano_anterior_dengue <- sum(df_ano_anterior_dengue %>% 
                                        arrange(desc(SE)) %>% 
                                        dplyr::select(municipio_geocodigo, pop) %>% 
                                        distinct(municipio_geocodigo, .keep_all = T) %>% 
                                        pull(pop), na.rm = T)

df_ano_anterior_dengue <- df_ano_anterior_dengue %>% 
  filter(SE <= (se_max_dengue - 100))

total_casos_ano_anterior_dengue <- sum(df_ano_anterior_dengue %>% 
                                         pull(casos), na.rm = T)
incidencia_acumulada_ano_anterior_dengue <- total_casos_ano_anterior_dengue/ pop_brasil_ano_anterior_dengue * 10^5

dif_prop_ano_dengue = total_casos_ano_selecionado_dengue/total_casos_ano_anterior_dengue
```

```{r, include = FALSE}
# Informacoes textuais - chikungunya

# Ano selecionado
df_ano_selecionado_chik <- df_chik %>% 
  filter(as.numeric(substr(SE, 1, 4))  == ano_selecionado) 

pop_brasil_ano_selecionado_chik <- sum(df_ano_selecionado_chik %>% 
                                         arrange(desc(SE)) %>% 
                                         dplyr::select(municipio_geocodigo, pop) %>% 
                                         distinct(municipio_geocodigo, .keep_all = T) %>% 
                                         pull(pop), na.rm = T)

total_casos_ano_selecionado_chik <- sum(df_ano_selecionado_chik %>% 
                                          pull(casos), na.rm = T)

total_casos_provaveis_ano_selecionado_chik <- sum(df_ano_selecionado_chik %>% 
                                                    pull(casprov), na.rm = T)

prop_casos_provaveis_chik <- paste0(round(total_casos_provaveis_ano_selecionado_chik/total_casos_ano_selecionado_chik *100, 2),"%")

incidencia_acumulada_ano_selecionado_chik <- total_casos_ano_selecionado_chik/ pop_brasil_ano_selecionado_chik * 10^5

# Ano anterior
df_ano_anterior_chik <- df_chik %>% 
  filter(as.numeric(substr(SE, 1, 4)) == (ano_selecionado - 1))

pop_brasil_ano_anterior_chik <- sum(df_ano_anterior_chik %>% 
                                      arrange(desc(SE)) %>% 
                                      dplyr::select(municipio_geocodigo, pop) %>% 
                                      distinct(municipio_geocodigo, .keep_all = T) %>% 
                                      pull(pop), na.rm = T)

df_ano_anterior_chik <- df_ano_anterior_chik %>% 
  filter(SE <= (se_max_chik - 100))

total_casos_ano_anterior_chik <- sum(df_ano_anterior_chik %>% 
                                       pull(casos), na.rm = T)
incidencia_acumulada_ano_anterior_chik <- total_casos_ano_anterior_chik/ pop_brasil_ano_anterior_chik * 10^5

dif_prop_ano_chik = total_casos_ano_selecionado_chik/total_casos_ano_anterior_chik
```


```{r, include = FALSE}
# Total
total_casos_ano_selecionado <- total_casos_ano_selecionado_dengue + total_casos_ano_selecionado_chik

total_casos_provaveis_ano_selecionado <- total_casos_provaveis_ano_selecionado_dengue + total_casos_provaveis_ano_selecionado_chik

prop_casos_provaveis_total <- paste0(round(((total_casos_provaveis_ano_selecionado)/(total_casos_ano_selecionado_dengue + total_casos_ano_selecionado_chik)) *100, 2),"%")

dif_prop_ano_total <- (total_casos_ano_selecionado_dengue + total_casos_ano_selecionado_chik)/(total_casos_ano_anterior_dengue + total_casos_ano_anterior_chik)

tabela_1 <- data.frame(
  agravo = c("Chikungunya", "Dengue", "Total"),
  casos_suspeitos = c(total_casos_ano_selecionado_chik, total_casos_ano_selecionado_dengue, total_casos_ano_selecionado),
  percentual_casos_suspeitos = c(prop_casos_provaveis_dengue, prop_casos_provaveis_chik, prop_casos_provaveis_total),
  var_relacao_ano_anterior = paste0(round(c(dif_prop_ano_chik, dif_prop_ano_dengue, dif_prop_ano_total)*100,2),"%")
) %>% 
  knitr::kable(row.names = F,
               col.names = c("Agravo",
                             "Casos notificados", 
                             "Percentual de casos prováveis",
                             "Variação em relação ao ano passado"),
               align = c("cccc"),
               format = "latex", digits = 2) %>%
  kable_styling(latex_options = c("hold_position", "scale_down")) %>% 
  row_spec(0, bold = T, background = "#d1e2f2", color = "black")
```

<!-- \newgeometry{top=20mm, left=10mm, bottom=20mm}  -->
<!-- \pagecolor{UoDDarkBlue}\afterpage{\nopagecolor} -->

<!-- \vspace*{1cm} -->

<!-- \fontsize{70}{75}\selectfont \textcolor{white}{\textbf{Informe}} -->

<!-- \fontsize{70}{75}\selectfont \textcolor{white}{\textbf{Infodengue}} -->

<!-- \vspace{10mm} -->
<!-- \Large\textcolor{white}{\textbf{Situação das arboviroses urbanas no Brasil}} -->
<!-- \newline -->
<!-- \normalsize -->
<!-- \textcolor{white}{`r format(Sys.Date(), format="%d %B %Y")`} -->
<!-- \vspace{120mm} -->

<!-- \thispagestyle{empty} -->

<!-- \restoregeometry    -->
<!-- \newpage -->

\begin{center}
\vspace{2cm}
\textbf{INFORME INFODENGUE}

\textbf{Informe da situação das arboviroses urbanas no Brasil (Semana epidemiológica `r ultima_semana_dengue`)}

\textit{Análises com base nos dados inseridos no SINAN ONLINE até o dia `r ultima_semana_fim`.}


\vspace{2cm}
\textbf{AVISOS:}
\end{center}

Esse boletim analisa as condições de transmissão da chikungunya e dengue no Brasil utilizando dados de clima e notificação de casos fornecidos pela Secretaria de Vigilância em Saúde (SVS). A partir desses dados são analisadas as condições de receptividade climática, transmissão e incidência (ver definição), tendo como objetivo contribuir para a tomada de decisão na sala de situação.

Todas as análises do InfoDengue são baseadas nos casos notificados, sem excluir os casos descartados. Isso ocorre devido à grande heterogeneidade no descarte de casos e porque a análise visa ser oportuna, não sendo viável esperar pelo tempo necessário para os testes laboratoriais. Portanto, utiliza-se um sistema de nowcasting para a predição de dados.

Os dados provenientes dos sistemas de notificação de casos podem conter erros de digitação ou preenchimento, afetando um ou mais dos diversos campos de registro. Por isso, as notificações são constantemente avaliadas para correções necessárias, conforme a análise da rede de vigilância e das equipes locais responsáveis por cada registro.

\vspace{\fill}
\begin{center}
\textbf{CRÉDITOS:}
\end{center}

**Produção:** Equipe Infodengue.

**Como citar:** Infodengue. Informe sobre situação de notificações de dengue no país, PROCC/Fiocruz e EMap/FGV, DATA.

\newpage

\begin{center}
\vspace{2cm}
\textbf{PRINCIPAIS PONTOS EM DESTAQUE}
\vspace{2cm}
\end{center}

<!-- Texto humano -->
\begin{itemize}
\item Iniciamos uma nova temporada típica na SE 40 2024, com curvas de casos estimados para arboviroses registrando leves tendências de aumentos em estados do Sul, Sudeste, Norte e Nordeste.
\item As incidências estimadas para dengue  se encontram decrescentes e estabilizadas na maior parte dos estados, com exceção de um crescimento leve nos  estados do Paraná, Santa Catarina e Roraima e Amapá;
\item Estados do Sul , RJ , SP, PA, AP e AM com atividade acima do histórico, sendo igual ou acima do observado no ano passado, que por sua vez, já haviam sido maiores que o histórico.
\item Santa Catarina e Paraná apresentando incidências acima dos canais endêmicos, a despeito da baixa receptividade climática no período. 
\end{itemize}

\vspace{2cm}
**Situação das Arboviroses no Brasil**

Esse ano foram notificados até o momento, `r prettyNum(total_casos_ano_selecionado, big.mark=".", decimal.mark = ",", scientific=FALSE)` casos suspeitos de dengue e chikungunya, o que corresponde a uma incidência acumulada de `r prettyNum(round(incidencia_acumulada_ano_selecionado_dengue, 0), big.mark=".", decimal.mark = ",", scientific=FALSE)` casos de dengue e `r prettyNum(round(incidencia_acumulada_ano_selecionado_chik, 0), big.mark=".", decimal.mark = ",", scientific=FALSE)` casos de chikungunya por 100 mil habitantes. Para dengue, esse valor corresponde a `r prettyNum(round(dif_prop_ano_dengue, 2), big.mark=".", decimal.mark = ",", scientific=FALSE)` vezes o registrado no ano passado, enquanto para chikungunya, a `r prettyNum(round(dif_prop_ano_chik, 2), big.mark=".", decimal.mark = ",", scientific=FALSE)`.
Do total de casos notificados, `r prettyNum(total_casos_provaveis_ano_selecionado, big.mark=".", decimal.mark = ",", scientific=FALSE)` foram classificados como provaveis até o momento. Isso é, `r  paste0(prettyNum(round(100 - total_casos_provaveis_ano_selecionado/total_casos_ano_selecionado *100, 2), big.mark=".", decimal.mark = ",", scientific=FALSE), "%")` foi descartado. 

**Tabela 1.** Casos notificados de arboviroses até a semana `r ultima_semana_dengue`

`r tabela_1`

\newpage
**Curvas de incidência e limiares epidemicos para dengue**

```{r, fig.align="center", fig.width = 12, fig.height = 14}
get_map_mem_incidencia(
  df_uf_inc = df_dengue_uf,
  df_uf_mem = memUFsazonal
)
```
**Figura 1.** Curvas de incidência e limiares epidemicos para dengue até a semana epidemiológica `r ultima_semana_dengue`.

\newpage
**Curvas de incidência e limiares epidemicos para chikungunya**

```{r, fig.align="center", fig.width = 12, fig.height = 14}
get_map_mem_incidencia(
  df_uf_inc = df_chik_uf,
  df_uf_mem = memUFsazonal.chi
)
```
**Figura 2.** Curvas de incidência e limiares epidemicos para chikungunya até a semana epidemiológica `r ultima_semana_chik`.

\newpage
**Casos Acumulados por Estados**

Na figura 3 e 4 estão representadas as incidências máximas anuais de dengue e chikungunya, por unidade da federação. Os pontos cinzas indicam os valores para os anos anteriores (2010 a 2023), o ponto vermelho indica a incidência máxima em 2024 e o ponto laranja a incidência na semana `r ultima_semana_dengue`.

```{r, fig.align="center", fig.width = 12, fig.height = 9}
df_dengue_chik_estados <- df_dengue_chik %>% 
  dplyr::select(arbovirose, SE, municipio_geocodigo, casos, pop) %>%
  mutate(
    arbovirose = factor(arbovirose, levels = c("Dengue", "Chikungunya")),
    ano = substr(SE, 1, 4),
    municipio_geocodigo = substr(municipio_geocodigo, 1, 2),
    municipio_geocodigo = as.character(municipio_geocodigo)
  ) %>% 
  rename(codigo = municipio_geocodigo) 

df_pop <- df_dengue_chik_estados %>% 
  filter(arbovirose == "Dengue") %>% 
  dplyr::select(codigo, ano, pop) %>% 
  group_by(codigo, ano) %>% 
  reframe(
    pop = sum(pop, na.rm = T)
  ) %>% 
  mutate(
    id = paste(codigo, ano, sep = "_")
  ) %>% 
  dplyr::select(-c(codigo, ano))

df_dengue_chik_estados_casos <- df_dengue_chik_estados %>% 
  group_by(arbovirose, codigo, ano) %>% 
  reframe(
    casos = sum(casos, na.rm = T)
  ) %>% 
  mutate(
    id = paste(codigo, ano, sep = "_")
  ) %>% 
  mutate(
    ano = as.numeric(ano),
    grupo = ifelse(ano ==  max(ano), max(ano), paste0(min(ano),"-",max(ano)-1))
  ) 

df_dengue_chik_estados_casos_atual <- df_dengue_chik_estados %>% 
  filter(SE == max(se_max_dengue, se_max_chik)) %>% 
  group_by(arbovirose, codigo, ano) %>% 
  reframe(
    casos = sum(casos, na.rm = T)
  )  %>% 
  mutate(
    id = paste(codigo, ano, sep = "_"),
    ano = as.numeric(ano),
    grupo = "Semana\natual"
  ) 

df_dengue_chik_estados <- df_dengue_chik_estados_casos %>% 
  bind_rows(df_dengue_chik_estados_casos_atual) %>% 
  left_join(df_pop, by = "id") %>% 
  mutate(
    inc = casos/pop * 100000
  ) %>% 
  mutate(
    grupo = factor(grupo, 
                   levels = c(
                     paste0(min(ano),"-",max(ano)-1),
                     max(ano), 
                     "Semana\natual")
    )
  ) %>% 
  obter_siglas_codigos() 

df_dengue_chik_estados$estado <-  stringi::stri_unescape_unicode(df_dengue_chik_estados$estado)

semana_epidemica_dengue_chik_estados <- df_dengue_chik_estados %>% 
  group_by(arbovirose, sigla) %>% 
  filter(ano == 2024) %>% 
  filter(inc == max(inc, na.rm = T)) %>% 
  dplyr::select(sigla, grupo) %>% 
  ungroup()
```


```{r}
dengue_semana_epidemica_estados <- semana_epidemica_dengue_chik_estados %>% 
  filter(arbovirose == "Dengue") %>% 
  filter(grupo == "Semana\natual") %>% 
  pull(sigla)

frase_dengue_1 <- texto_1(dengue_semana_epidemica_estados, arbovirose = "dengue")
```

`r frase_dengue_1`

```{r, fig.align="center", fig.width = 12, fig.height = 4}
df_dengue_chik_estados %>% 
  filter(arbovirose == "Dengue") %>% 
  gg_timeline_dots()
```
**Figura 3.** Incidência acumulada por 100 mil habitantes sobre os casos notificados de dengue até a semana `r ultima_semana_dengue`.

```{r}
chik_semana_epidemica_estados <- semana_epidemica_dengue_chik_estados %>% 
  filter(arbovirose == "Chikungunya") %>% 
  filter(grupo == "Semana\natual") %>% 
  pull(sigla)

frase_chik_1 <- texto_1(chik_semana_epidemica_estados, arbovirose = "chikungunya")
```

`r frase_chik_1`

```{r, fig.align="center", fig.width = 12, fig.height = 4}
df_dengue_chik_estados %>% 
  filter(arbovirose == "Chikungunya") %>% 
  gg_timeline_dots()
```
**Figura 4.** Incidência acumulada por 100 mil habitantes sobre os casos notificados de chikungunya até a semana `r ultima_semana_dengue`.

<!-- \newpage -->
<!-- As curvas de casos semanais de dengue e chikungunya são apresentadas na figura 2. Observa-se que está (dentro/fora) do previsto. -->

<!-- \vspace{1cm} -->
<!-- **Adicionar figura 3** -->
<!-- \newline -->
<!-- **Figura 3.** Curvas de previsão de casos semanais no Brasil para Dengue e Chikungunya   -->

\newpage
As curvas de incidência dos casos notificados e os casos estimados de acordo com o nowcast, por estado, são apresentadas na figura 5. Observa-se uma uma tendência geral de queda nas taxas de incidência em todos os estados ao longo do tempo, com diferenças no nível inicial e na taxa de queda entre os estados.


```{r, fig.align="center", fig.width = 12, fig.height = 14}
df_inc_dengue_chik <- df_dengue %>% 
  dplyr::select(SE, municipio_geocodigo, casos, casos_est, pop) %>%
  bind_rows(
    df_chik %>% 
      dplyr::select(SE, municipio_geocodigo, casos, casos_est, pop)
  ) %>% 
  mutate(
    codigo = substr(municipio_geocodigo, 1, 2),
    codigo = as.character(codigo)
  ) %>% 
  dplyr::select(SE, codigo, casos, casos_est, pop) %>%
  filter(SE >=  unique(SE)[length(unique(SE))-12]) %>%
  group_by(SE, codigo) %>%
  reframe(
    casos = sum(casos, na.rm = T),
    casos_est = sum(casos_est, na.rm = T),
    pop = sum(unique(pop))
  ) %>%
  mutate(
    inc = casos/pop * 100000,
    inc_est = casos_est/pop * 100000,
    data = SE2date(SE)$ini
  ) %>% 
  obter_siglas_codigos()
df_inc_dengue_chik$estado <- stringi::stri_unescape_unicode(df_inc_dengue_chik$estado)

df_inc_dengue_chik %>% 
  gg_inc_dengue_chikv()
```
**Figura 5.** Incidência de casos notificados de arboviroses (chikungunya + dengue) nas Unidades da Federação.

\newpage
**Panorama da tendência dos novos casos de dengue até a semana `r ultima_semana_dengue`**

A tabela 2 apresenta um panorama sobre a tendência da incidência de dengue para casos notificados e estimados em todo o país até a semana `r ultima_semana_dengue`. As **setas** indicam se os casos estão crescendo ou decrescendo significativamente.

<!-- , e o **Rt** é a taxa de crescimento do último mês. O **Rt** mede o número médio de casos secundários gerados por casos primários considerando um intervalo de 3 semanas, e a **\%pop** indica a porcentagem da população da UF vivendo em regionais com transmissão alta para os padrões históricos.  -->

**Tabela 2.** Situação dos estados em relação à notificação dos casos de dengue em 2024.
```{r}
tabela_tendencia_por_uf_inc_observada_dengue <- df_dengue_uf %>% 
  construir_tabela_incidencia_por_semana(var = "inc")

tabela_tendencia_por_uf_inc_estimada_dengue <- df_dengue_uf %>% 
  construir_tabela_incidencia_por_semana(var = "incest")

tabela_tendencia_por_uf_inc_observada_dengue <- verificar_tendencia_regressao(tabela_tendencia_por_uf_inc_observada_dengue)

tabela_tendencia_por_uf_inc_estimada_dengue <- verificar_tendencia_regressao(tabela_tendencia_por_uf_inc_estimada_dengue)

tabela_tendencia_por_uf_inc_observada_dengue <- tabela_tendencia_por_uf_inc_observada_dengue %>% 
  obter_siglas_codigos() %>% 
  adicionar_regiao() %>% 
  relocate(regiao, .before = codigo) %>% 
  relocate(sigla, .after = regiao) %>% 
  as_tibble() %>% 
  dplyr::select(-c(codigo, estado))

tabela_tendencia_por_uf_inc_estimada_dengue <- tabela_tendencia_por_uf_inc_estimada_dengue %>% 
  obter_siglas_codigos() %>% 
  adicionar_regiao() %>% 
  relocate(regiao, .before = codigo) %>% 
  relocate(sigla, .after = regiao) %>% 
  as_tibble() %>% 
  dplyr::select(-c(codigo, estado))

inc_obs_max_dengue <- ceiling(max(tabela_tendencia_por_uf_inc_observada_dengue[3:6], na.rm = T))
inc_est_max_dengue <- ceiling(max(tabela_tendencia_por_uf_inc_estimada_dengue[3:6], na.rm = T))

tab_tendencia_por_uf_inc_observada_dengue <- tabela_tendencia_por_uf_inc_observada_dengue %>% 
  bind_cols(tabela_tendencia_por_uf_inc_estimada_dengue %>% 
              dplyr::select(-c(regiao, sigla))) %>% 
  gerar_tabela_tendencia(inc_obs_max = inc_obs_max_dengue, inc_est_max = inc_est_max_dengue)

tab_tendencia_por_uf_inc_observada_dengue
```

\newpage
**Panorama da tendência dos novos casos de chikungunya até a semana `r ultima_semana_dengue`**

A tabela 3 apresenta um panorama sobre a tendência da incidência de dengue para casos notificados e estimados em todo o país até a semana `r ultima_semana_dengue`. A **tendência** indica se os casos estão crescendo ou decrescendo significativamente.

**Tabela 3.** Situação dos estados em relação à notificação dos casos de chikungunya em 2024.
```{r}
tabela_tendencia_por_uf_inc_observada_chik <- df_chik_uf %>% 
  construir_tabela_incidencia_por_semana(var = "inc")

tabela_tendencia_por_uf_inc_estimada_chik <- df_chik_uf %>% 
  construir_tabela_incidencia_por_semana(var = "incest")

tabela_tendencia_por_uf_inc_observada_chik <- verificar_tendencia_regressao(tabela_tendencia_por_uf_inc_observada_chik)

tabela_tendencia_por_uf_inc_estimada_chik <- verificar_tendencia_regressao(tabela_tendencia_por_uf_inc_estimada_chik)

tabela_tendencia_por_uf_inc_observada_chik <- tabela_tendencia_por_uf_inc_observada_chik %>% 
  obter_siglas_codigos() %>% 
  adicionar_regiao() %>% 
  relocate(regiao, .before = codigo) %>% 
  relocate(sigla, .after = regiao) %>% 
  as_tibble() %>% 
  dplyr::select(-c(codigo, estado))

tabela_tendencia_por_uf_inc_estimada_chik <- tabela_tendencia_por_uf_inc_estimada_chik %>% 
  obter_siglas_codigos() %>% 
  adicionar_regiao() %>% 
  relocate(regiao, .before = codigo) %>% 
  relocate(sigla, .after = regiao) %>% 
  as_tibble() %>% 
  dplyr::select(-c(codigo, estado))

inc_obs_max_chik <- ceiling(max(tabela_tendencia_por_uf_inc_observada_chik[3:6], na.rm = T))
inc_est_max_chik <- ceiling(max(tabela_tendencia_por_uf_inc_estimada_chik[3:6], na.rm = T))

tab_tendencia_por_uf_inc_observada_chik <- tabela_tendencia_por_uf_inc_observada_chik %>% 
  bind_cols(tabela_tendencia_por_uf_inc_estimada_chik %>% 
              dplyr::select(-c(regiao, sigla))) %>% 
  gerar_tabela_tendencia(inc_obs_max = inc_obs_max_chik, inc_est_max = inc_est_max_chik)

tab_tendencia_por_uf_inc_observada_chik
```

\newpage
\textbf{Estados/Regionais com aumento de Casos de dengue}

```{r, include = FALSE}
n_regionais_incidencia_dengue_alto_em_subida <- shape_dengue %>% filter(status == "Alto em subida") %>% pull() %>% length()

n_regionais_incidencia_dengue_alto_estavel <- shape_dengue %>% filter(status == "Alto estavel") %>% pull() %>% length()

n_regionais_incidencia_dengue_alto_em_queda <- shape_dengue %>% filter(status == "Alto em queda") %>% pull() %>% length()

n_regionais_incidencia_dengue_baixo <- shape_dengue %>% filter(status == "Baixo ou moderado") %>% pull() %>% length()
```

De acordo com a figura 6, do total de 450 regionais, `r n_regionais_incidencia_dengue_alto_em_subida` estão com alta incidência e continuam subindo, `r n_regionais_incidencia_dengue_alto_estavel` estão com alta, porém estável, `r n_regionais_incidencia_dengue_alto_em_queda` estão com alta, mas em queda e `r n_regionais_incidencia_dengue_baixo` estão com baixa ou moderada incidência de dengue.

```{r, fig.align="center", fig.width = 12, fig.height = 14}
gg_map_risco_classif_dengue
```
**Figura 6.** Regionais de saúde que a incidência de dengue esta em tendência de alta em subida (vermelho), alto estável (laranja), alto em queda (amarelo) e baixo ou moderado (verde).

\newpage
\textbf{Estados/Regionais com aumento de casos de chikungunya}

```{r, include = FALSE}
n_regionais_incidencia_chik_alto_em_subida <- shape_chik %>% filter(status == "Alto em subida") %>% pull() %>% length()

n_regionais_incidencia_chik_alto_estavel <- shape_chik %>% filter(status == "Alto estavel") %>% pull() %>% length()

n_regionais_incidencia_chik_alto_em_queda <- shape_chik %>% filter(status == "Alto em queda") %>% pull() %>% length()

n_regionais_incidencia_chik_baixo <- shape_chik %>% filter(status == "Baixo ou moderado") %>% pull() %>% length()
```

De acordo com a figura 6, do total de 450 regionais, `r n_regionais_incidencia_chik_alto_em_subida` estão com alta incidência e continuam subindo, `r n_regionais_incidencia_chik_alto_estavel` estão com alta, porém estável, `r n_regionais_incidencia_chik_alto_em_queda` estão com alta, mas em queda e `r n_regionais_incidencia_chik_baixo` estão com baixa ou moderada incidência de chikungunya

```{r, fig.align="center", fig.width = 12, fig.height = 14}
gg_map_risco_classif_chik
```
**Figura 7.** Regionais de saúde que a incidência de chikungunya esta em tendência de alta em subida (vermelho), alto estável (laranja), alto em queda (amarelo) e baixo ou moderado (verde).

<!-- Adicionar tabela com as principais mudancas  -->
<!-- Durante a última quinzena, algumas regionais (estados?) apresentaram mudanças nos padrões de notificação. Segue um panorama geral das principais mudanças:  -->

<!-- \newpage -->
<!-- \textbf{OBSERVAÇÕES SOBRE A METODOLOGIA} -->

<!-- A atualização dos dados pode resultar em mudanças nas estimativas. Para detalhes sobre as metodologias, consultar o site do Infodengue e as referências citadas ao fim do documento.  -->

\vspace{2cm}
\textbf{AUTORES}

\textbf{Equipe do Infodengue:} Claudia Torres Codeço$^{a}$,Leonardo Soares Bastos$^{a}$, Oswaldo Gonçalves Cruza$^{a}$, Sara de Souza Oliveira$^{a}$, Eduardo Correa Araujo$^{d}$, Raquel Martins Lana$^{b}$, Danielle Andreza da Cruz Ferreira$^{a}$, Vinicius Barbosa Godinho$^{a}$, Sandro Locha$^{a}$, Luã Bida Vacaro$^{d}$, Lucas Monteiro Bianchi$^{e}$, Thais Irene Souza Riback$^{a}$, Iasmim Ferreira de Almeida$^{a}$, and Flávio Codeço Coelho$^{a}$. 

$^{a}$Scientific Computing Program, Oswaldo Cruz Foundation, Brazil

$^{b}$Barcelona Supercomputing Center (BSC), Barcelona, Spain

$^{c}$Federal University of Minas Gerais, Brazil

$^{d}$School of Applied Math, Getulio Vargas Foundation, Brazil

$^{e}$National School of Public Health, Oswaldo Cruz Foundation, Brazil


<!-- # Informe e colocar a semana -->
<!-- # Trocar a tendencia por seta -->
<!-- # Cor por limiar da incidencia -->
<!-- # Adicionar o RT -->